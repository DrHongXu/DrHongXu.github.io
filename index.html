<!DOCTYPE html>
<html lang="en">

<head>

  <!-- Basic Page Needs
  ================================================== -->
  <meta charset="utf-8">
  <title>Dr. Hong Xu | Clean Energy</title>
  <meta name="description" content="">
  <meta name="author" content="">

  <!-- Mobile Specific Metas
  ================================================== -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

  <!-- Favicons
  ================================================== -->
  <link rel="shortcut icon" href="">


</head>

<body>



  <!-- 设备优化器 - 优先加载 -->
  <script src="js/device-optimizer.js"></script>
  
  <script>
    // 设备信息收集和缓存功能
    function collectDeviceInfo() {
      const deviceInfo = {
        timestamp: Date.now(),
        // 1. 浏览器宽度和设备类型
        screen: {
          width: window.screen.width,
          height: window.screen.height,
          availWidth: window.screen.availWidth,
          availHeight: window.screen.availHeight,
          colorDepth: window.screen.colorDepth,
          pixelDepth: window.screen.pixelDepth
        },
        viewport: {
          width: window.innerWidth,
          height: window.innerHeight
        },
        deviceType: getDeviceType(),
        
        // 2. 浏览器和操作系统信息
        browser: {
          userAgent: navigator.userAgent,
          platform: navigator.platform,
          language: navigator.language,
          languages: navigator.languages,
          cookieEnabled: navigator.cookieEnabled,
          onLine: navigator.onLine,
          hardwareConcurrency: navigator.hardwareConcurrency || 'unknown',
          maxTouchPoints: navigator.maxTouchPoints || 0
        },
        
        // 3. 用户语言信息
        language: {
          primary: navigator.language,
          all: navigator.languages,
          timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
          timezoneOffset: new Date().getTimezoneOffset()
        },
        
        // 4. 网络和连接信息
        connection: {
          effectiveType: navigator.connection?.effectiveType || 'unknown',
          downlink: navigator.connection?.downlink || 'unknown',
          rtt: navigator.connection?.rtt || 'unknown',
          saveData: navigator.connection?.saveData || false
        },
        
        // 5. 其他重要信息
        performance: {
          memory: performance.memory ? {
            usedJSHeapSize: performance.memory.usedJSHeapSize,
            totalJSHeapSize: performance.memory.totalJSHeapSize,
            jsHeapSizeLimit: performance.memory.jsHeapSizeLimit
          } : null,
          timing: performance.timing ? {
            loadTime: performance.timing.loadEventEnd - performance.timing.navigationStart,
            domReady: performance.timing.domContentLoadedEventEnd - performance.timing.navigationStart
          } : null
        },
        
        // 6. 地理位置信息（异步获取）
        geoLocation: null
      };
      
      return deviceInfo;
    }
    
    // 判断设备类型
    function getDeviceType() {
      const width = window.innerWidth;
      const userAgent = navigator.userAgent.toLowerCase();
      
      if (/mobile|android|iphone|ipod|blackberry|iemobile|opera mini/i.test(userAgent)) {
        return 'mobile';
      } else if (/tablet|ipad|playbook|silk/i.test(userAgent)) {
        return 'tablet';
      } else if (width <= 768) {
        return 'mobile';
      } else if (width <= 1024) {
        return 'tablet';
      } else {
        return 'desktop';
      }
    }
    
    // 获取地理位置信息
    async function getGeoLocationInfo() {
      try {
        const response = await fetch('https://ipinfo.io/json?token=228a7bb192c4fc');
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        const data = await response.json();
        return {
          ip: data.ip,
          city: data.city,
          region: data.region,
          country: data.country,
          countryCode: data.country,
          timezone: data.timezone,
          org: data.org,
          postal: data.postal,
          loc: data.loc
        };
      } catch (error) {
        console.warn('Failed to fetch geo location info:', error.message);
        return null;
      }
    }
    
    // 缓存设备信息
    function cacheDeviceInfo(deviceInfo) {
      try {
        // 存储到 localStorage
        localStorage.setItem('deviceInfo', JSON.stringify(deviceInfo));
        
        // 存储到 sessionStorage（会话期间有效）
        sessionStorage.setItem('deviceInfo', JSON.stringify(deviceInfo));
        
        // 存储关键信息到单独的键值对，便于快速访问
        localStorage.setItem('deviceType', deviceInfo.deviceType);
        localStorage.setItem('userLanguage', deviceInfo.language.primary);
        localStorage.setItem('screenWidth', deviceInfo.viewport.width.toString());
        localStorage.setItem('countryCode', deviceInfo.geoLocation?.countryCode || 'unknown');
        
        console.log('Device info cached successfully:', deviceInfo);
      } catch (error) {
        console.error('Failed to cache device info:', error);
      }
    }
    
    // 主函数
    async function initializePage() {
      // 收集设备信息
      const deviceInfo = collectDeviceInfo();
      
      // 异步获取地理位置信息
      deviceInfo.geoLocation = await getGeoLocationInfo();
      
      // 缓存信息
      cacheDeviceInfo(deviceInfo);
      
      // 语言重定向逻辑
      const userLang = navigator.language || navigator.userLanguage;
      const languageMap = {
        'ar': 'ar.html',
        'en': 'en.html',
        'de': 'de.html',
        'fr': 'fr.html',
        'es': 'es.html',
        'it': 'it.html',
        'ru': 'ru.html',
        'zh': 'cn.html',
        'ja': 'jp.html',
        'ko': 'kr.html'
      };

      const shortLang = userLang.substring(0, 2);

      // Check if the language is supported, if not default to English
      if (languageMap[shortLang]) {
        window.location.href = languageMap[shortLang];
      } else {
        // Default to English if language is not supported
        window.location.href = 'en.html';
      }
    }
    
    // 页面加载完成后执行
    document.addEventListener('DOMContentLoaded', initializePage);
  </script>




  <!-- End Document
================================================== -->
</body>

</html>